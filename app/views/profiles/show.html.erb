<div class="container">
  <% if @user && @user.profile %>
    <div class="row">
      <div class="col-md-4">
        <div class="card mb-4">
          <div class="card-body text-center">
            <!-- –ê–≤–∞—Ç–∞—Ä -->
            <% if @user.profile.avatar.attached? %>
              <%= image_tag @user.profile.avatar.variant(resize: "150x150"), 
                    class: "rounded-circle mb-3",
                    style: "width: 150px; height: 150px; object-fit: cover;" %>
            <% else %>
              <div class="rounded-circle bg-secondary d-flex align-items-center justify-content-center mx-auto mb-3" 
                   style="width: 150px; height: 150px;">
                <span class="text-white display-4"><%= @user.email[0].upcase %></span>
              </div>
            <% end %>
            
            <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <h4><%= @user.email %></h4>
            
            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="row text-center mt-3">
              <div class="col-6">
                <h5 class="mb-0"><%= @collections_count %></h5>
                <small class="text-muted">–ö–æ–ª–ª–µ–∫—Ü–∏–π</small>
              </div>
              <div class="col-6">
                <h5 class="mb-0"><%= @games_count %></h5>
                <small class="text-muted">–ò–≥—Ä –≤—Å–µ–≥–æ</small>
              </div>
            </div>
            
            <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
            <% if @user != current_user %>
              <div class="mt-3">
                <% case @friendship_status %>
                <% when :friends %>
                  <span class="badge bg-success mb-3">–î—Ä—É–≥</span>
                  <%= link_to "–£–¥–∞–ª–∏—Ç—å –∏–∑ –¥—Ä—É–∑–µ–π", 
                        friendship_path(@user), 
                        method: :delete,
                        data: { confirm: "–£–¥–∞–ª–∏—Ç—å –∏–∑ –¥—Ä—É–∑–µ–π?" },
                        class: "btn btn-danger w-100" %>
                <% when :request_sent %>
                  <span class="badge bg-warning text-dark mb-3">–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞</span>
                  <%= link_to "–û—Ç–º–µ–Ω–∏—Ç—å –∑–∞—è–≤–∫—É", 
                        friendship_path(@user), 
                        method: :delete,
                        data: { confirm: "–û—Ç–º–µ–Ω–∏—Ç—å –∑–∞—è–≤–∫—É?" },
                        class: "btn btn-warning w-100" %>
                <% when :request_received %>
                  <span class="badge bg-info mb-3">–ü—Ä–∏—Å–ª–∞–ª –≤–∞–º –∑–∞—è–≤–∫—É</span>
                  <div class="d-grid gap-2">
                    <%= link_to "–ü—Ä–∏–Ω—è—Ç—å", 
                          friendship_path(@user), 
                          method: :patch,
                          class: "btn btn-success" %>
                    <%= link_to "–û—Ç–∫–ª–æ–Ω–∏—Ç—å", 
                          friendship_path(@user), 
                          method: :delete,
                          data: { confirm: "–û—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–∞—è–≤–∫—É?" },
                          class: "btn btn-danger" %>
                  </div>
                <% else %>
                  <%= link_to "–î–æ–±–∞–≤–∏—Ç—å –≤ –¥—Ä—É–∑—å—è", 
                        friendships_path(friend_id: @user.id), 
                        method: :post,
                        class: "btn btn-primary w-100" %>
                <% end %>
                <%= link_to "–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ", "#", class: "btn btn-outline-primary w-100 mt-2" %>
              </div>
            <% else %>
              <div class="mt-3">
                <%= link_to "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å", edit_my_profile_path, class: "btn btn-info w-100 mb-2" %>
                <%= link_to "–ú–æ–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–∏", collections_path, class: "btn btn-success w-100 mb-2" %>
                <%= link_to "–ú–æ–∏ –¥—Ä—É–∑—å—è", friendships_path, class: "btn btn-primary w-100" %>
              </div>
            <% end %>
            
            <hr>
            <small class="text-muted">
              –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: <%= l(@user.created_at, format: :long) %><br>
              <% if @user.respond_to?(:current_sign_in_at) && @user.current_sign_in_at %>
                –ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥: <%= l(@user.current_sign_in_at, format: :short) %>
              <% end %>
            </small>
          </div>
        </div>
      </div>
      
      <div class="col-md-8">
        <!-- –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è -->
        <div class="card mb-4">
          <div class="card-header">
            <h5 class="mb-0">–û –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ</h5>
          </div>
          <div class="card-body">
            <% if @user.profile.bio.present? %>
              <p class="lead"><%= @user.profile.bio %></p>
            <% else %>
              <p class="text-muted">
                <%= @user == current_user ? 
                    "–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Å–µ–±–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–æ—Ñ–∏–ª—è!" : 
                    "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–∏–ª –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–µ–±–µ." %>
              </p>
            <% end %>
            
            <hr>
            
            <div class="row">
              <div class="col-md-6">
                <p><strong>–°—Ç–∞—Ç—É—Å –ø—Ä–æ—Ñ–∏–ª—è:</strong><br>
                  <span class="badge <%= @user.profile.private? ? 'bg-secondary' : 'bg-success' %>">
                    <%= @user.profile.private? ? 'üîí –ü—Ä–∏–≤–∞—Ç–Ω—ã–π' : 'üåê –ü—É–±–ª–∏—á–Ω—ã–π' %>
                  </span>
                </p>
              </div>
              <div class="col-md-6">
                <p><strong>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:</strong><br>
                  <%= l(@user.created_at.to_date, format: :long) %>
                </p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- –ö–æ–ª–ª–µ–∫—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
        <% if @can_view_collections && @public_collections.any? %>
          <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h5 class="mb-0">–ö–æ–ª–ª–µ–∫—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h5>
              <span class="badge bg-primary"><%= @collections_count %></span>
            </div>
            <div class="card-body">
              <% if @top_collections.any? %>
                <div class="row">
                  <% @top_collections.each do |collection| %>
                    <div class="col-md-4 mb-3">
                      <div class="card h-100">
                        <div class="card-body">
                          <h6 class="card-title">
                            <%= collection.name %>
                            <span class="badge bg-secondary"><%= collection.games_count %></span>
                          </h6>
                          <% if collection.description.present? %>
                            <p class="card-text text-muted small">
                              <%= collection.description.truncate(60) %>
                            </p>
                          <% end %>
                        </div>
                        <div class="card-footer bg-transparent">
                          <%= link_to "–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å", collection_path(collection), 
                                class: "btn btn-sm btn-outline-primary w-100" %>
                        </div>
                      </div>
                    </div>
                  <% end %>
                </div>
                
                <% if @collections_count > 3 %>
                  <div class="text-center mt-3">
                    <%= link_to "–í—Å–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è", collections_path(user_id: @user.id), 
                          class: "btn btn-outline-secondary btn-sm" %>
                  </div>
                <% end %>
              <% else %>
                <p class="text-muted text-center py-3">
                  –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–∫–∞ –Ω–µ—Ç –∫–æ–ª–ª–µ–∫—Ü–∏–π
                </p>
              <% end %>
            </div>
          </div>
        <% elsif @can_view_collections %>
          <div class="card mb-4">
            <div class="card-header">
              <h5 class="mb-0">–ö–æ–ª–ª–µ–∫—Ü–∏–∏</h5>
            </div>
            <div class="card-body">
              <p class="text-muted text-center py-3">
                –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–ª –∫–æ–ª–ª–µ–∫—Ü–∏–π
              </p>
            </div>
          </div>
        <% elsif @user != current_user %>
          <div class="card mb-4">
            <div class="card-header">
              <h5 class="mb-0">–ö–æ–ª–ª–µ–∫—Ü–∏–∏</h5>
            </div>
            <div class="card-body">
              <p class="text-muted text-center py-3">
                <% if @user.profile.private? %>
                  üîí –ö–æ–ª–ª–µ–∫—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ
                <% else %>
                  –ß—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –Ω—É–∂–Ω–æ –±—ã—Ç—å –¥—Ä—É–∑—å—è–º–∏
                <% end %>
              </p>
            </div>
          </div>
        <% end %>
        
        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h5>
          </div>
          <div class="card-body">
            <ul class="list-group list-group-flush">
              <li class="list-group-item d-flex justify-content-between align-items-center">
                –ö–æ–ª–ª–µ–∫—Ü–∏–∏
                <span class="badge bg-primary rounded-pill"><%= @collections_count %></span>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-center">
                –í—Å–µ–≥–æ –∏–≥—Ä –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—è—Ö
                <span class="badge bg-success rounded-pill"><%= @games_count %></span>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-center">
                –î—Ä—É–∑–µ–π
                <span class="badge bg-info rounded-pill">
                  <%= @user.accepted_friends.count if Friendship.table_exists? %>
                </span>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-center">
                –ù–∞ —Å–∞–π—Ç–µ
                <span class="text-muted"><%= time_ago_in_words(@user.created_at) %></span>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    
    <div class="mt-3">
      <%= link_to "‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π", users_path, class: "btn btn-outline-secondary" %>
    </div>
  <% else %>
    <div class="text-center py-5">
      <h2>–ü—Ä–æ—Ñ–∏–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω</h2>
      <p class="text-muted">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.</p>
      <%= link_to "–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π", users_path, class: "btn btn-primary" %>
    </div>
  <% end %>
</div>