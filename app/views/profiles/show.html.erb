<div class="container">
  <% if @user && @user.profile %>
    <div class="row">
      <div class="col-md-4">
        <div class="card mb-4">
          <div class="card-body text-center">
            <!-- –ê–≤–∞—Ç–∞—Ä -->
            <% if @user.profile.avatar.attached? %>
              <%= image_tag @user.profile.avatar.variant(resize: "150x150"), 
                    class: "rounded-circle mb-3",
                    style: "width: 150px; height: 150px; object-fit: cover;" %>
            <% else %>
              <div class="rounded-circle bg-secondary d-flex align-items-center justify-content-center mx-auto mb-3" 
                   style="width: 150px; height: 150px;">
                <span class="text-white display-4"><%= @user.email[0].upcase %></span>
              </div>
            <% end %>
            
            <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <h4><%= @user.email %></h4>
            
            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="row text-center mt-3">
              <div class="col-6">
                <h5 class="mb-0"><%= @collections_count || 0 %></h5>
                <small class="text-muted">–ö–æ–ª–ª–µ–∫—Ü–∏–π</small>
              </div>
              <div class="col-6">
                <h5 class="mb-0"><%= @games_count || 0 %></h5>
                <small class="text-muted">–ò–≥—Ä –≤—Å–µ–≥–æ</small>
              </div>
            </div>
          </div>

          <% if @user != current_user %>
            <div class="mt-3">
              <% case @friendship_status %>
              <% when :friends %>
                <span class="badge bg-success mb-2">–î—Ä—É–≥</span>
              <% when :request_sent %>
                <span class="badge bg-warning text-dark mb-2">–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞</span>
              <% when :request_received %>
                <span class="badge bg-info mb-2">–û–∂–∏–¥–∞–µ—Ç –æ—Ç–≤–µ—Ç–∞</span>
              <% else %>
                <%= link_to "–î–æ–±–∞–≤–∏—Ç—å –≤ –¥—Ä—É–∑—å—è",
                      friendships_path(friend_id: @user.id),
                      method: :post,
                      class: "btn btn-primary w-100" %>
              <% end %>
            </div>
          <% else %>
            <div class="mt-3">
              <%= link_to "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å", edit_my_profile_path,
                    class: "btn btn-info w-100 mb-2" %>
              <%= link_to "–ú–æ–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–∏", collections_path,
                    class: "btn btn-success w-100" %>
              <%= link_to "–ú–æ–∏ –¥—Ä—É–∑—å—è",
          friendships_path,
          class: "btn btn-primary w-100" %>
            </div>
          <% end %>

        </div>
      </div>
    </div>

    <!-- –ü–†–ê–í–ê–Ø –ö–û–õ–û–ù–ö–ê -->
    <div class="col-md-8">

      <!-- –û –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï -->
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="mb-0">–û –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ</h5>
        </div>
        <div class="card-body">
          <% if @profile.bio.present? %>
            <p class="lead"><%= @profile.bio %></p>
          <% else %>
            <p class="text-muted">
              <%= @user == current_user ?
                "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è" :
                "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –¥–æ–±–∞–≤–∏–ª –æ–ø–∏—Å–∞–Ω–∏–µ" %>
            </p>
          <% end %>
        </div>
      </div>

      <!-- –ö–û–õ–õ–ï–ö–¶–ò–ò -->
      <% if @can_view_collections %>
        <div class="card mb-4">
          <div class="card-header">
            <h5 class="mb-0">–ö–æ–ª–ª–µ–∫—Ü–∏–∏</h5>
          </div>
          <div class="card-body">
            <% if @user.profile.bio.present? %>
              <p class="lead"><%= @user.profile.bio %></p>
            <% else %>
              <p class="text-muted">
                <%= @user == current_user ? 
                    "–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Å–µ–±–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–æ—Ñ–∏–ª—è!" : 
                    "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–∏–ª –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–µ–±–µ." %>
              </p>
            <% end %>
            
            <hr>
            
            <div class="row">
              <div class="col-md-6">
                <p><strong>–°—Ç–∞—Ç—É—Å –ø—Ä–æ—Ñ–∏–ª—è:</strong><br>
                  <span class="badge <%= @user.profile.private? ? 'bg-secondary' : 'bg-success' %>">
                    <%= @user.profile.private? ? 'üîí –ü—Ä–∏–≤–∞—Ç–Ω—ã–π' : 'üåê –ü—É–±–ª–∏—á–Ω—ã–π' %>
                  </span>
                </p>
              </div>
              <div class="col-md-6">
                <p><strong>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:</strong><br>
                  <%= l(@user.created_at.to_date, format: :long) %>
                </p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- –ö–æ–ª–ª–µ–∫—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
        <% if @can_view_collections && @public_collections && @public_collections.any? %>
          <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h5 class="mb-0">–ö–æ–ª–ª–µ–∫—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h5>
              <span class="badge bg-primary"><%= @collections_count || 0 %></span>
            </div>
            <div class="card-body">
              <% if @top_collections && @top_collections.any? %>
                <div class="row">
                  <% @top_collections.each do |collection| %>
                    <div class="col-md-4 mb-3">
                      <div class="card h-100">
                        <div class="card-body">
                          <h6 class="card-title">
                            <%= collection.name %>
                            <span class="badge bg-secondary"><%= collection.games_count || 0 %></span>
                          </h6>
                          <% if collection.description.present? %>
                            <p class="card-text text-muted small">
                              <%= collection.description.truncate(60) %>
                            </p>
                          <% end %>
                        </div>
                        <div class="card-footer bg-transparent">
                          <%= link_to "–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å", collection_path(collection), 
                                class: "btn btn-sm btn-outline-primary w-100" %>
                        </div>
                      </div>
                    </div>
                  <% end %>
                </div>
                
                <% if @collections_count && @collections_count > 3 %>
                  <div class="text-center mt-3">
                    <%= link_to "–í—Å–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è", collections_path(user_id: @user.id), 
                          class: "btn btn-outline-secondary btn-sm" %>
                  </div>
                <% end %>
              </div>
            <% else %>
              <p class="text-muted text-center">–ö–æ–ª–ª–µ–∫—Ü–∏–π –ø–æ–∫–∞ –Ω–µ—Ç</p>
            <% end %>

          </div>
        </div>
      <% else %>
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h5>
          </div>
          <div class="card-body">
            <ul class="list-group list-group-flush">
              <li class="list-group-item d-flex justify-content-between align-items-center">
                –ö–æ–ª–ª–µ–∫—Ü–∏–∏
                <span class="badge bg-primary rounded-pill"><%= @collections_count || 0 %></span>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-center">
                –í—Å–µ–≥–æ –∏–≥—Ä –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—è—Ö
                <span class="badge bg-success rounded-pill"><%= @games_count || 0 %></span>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-center">
                –î—Ä—É–∑–µ–π
                <span class="badge bg-info rounded-pill">
                  <% if Friendship.table_exists? && @user.respond_to?(:accepted_friends) %>
                    <%= @user.accepted_friends.count %>
                  <% else %>
                    0
                  <% end %>
                </span>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-center">
                –ù–∞ —Å–∞–π—Ç–µ
                <span class="text-muted"><%= time_ago_in_words(@user.created_at) %></span>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    
    <div class="mt-3">
      <!-- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Å—Å—ã–ª–∫–∞: –∏—Å–ø–æ–ª—å–∑—É–µ–º :back –≤–º–µ—Å—Ç–æ users_path -->
      <%= link_to "‚Üê –ù–∞–∑–∞–¥", :back, class: "btn btn-outline-secondary" %>
    </div>
  <% else %>
    <div class="text-center py-5">
      <h2>–ü—Ä–æ—Ñ–∏–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω</h2>
      <p class="text-muted">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.</p>
      <!-- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Å—Å—ã–ª–∫–∞: –∏—Å–ø–æ–ª—å–∑—É–µ–º root_path –∏–ª–∏ :back –≤–º–µ—Å—Ç–æ users_path -->
      <%= link_to "–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é", root_path, class: "btn btn-primary" %>
    </div>
  </div>
</div>
