<div class="game-show">
  <div class="d-flex justify-content-between align-items-start">
    <h1><%= @game.title %></h1>
    <div>
      <%= link_to "‚Üê –í—Å–µ –∏–≥—Ä—ã", games_path, class: "btn btn-outline-secondary" %>
      <%= link_to "‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å", edit_game_path(@game), class: "btn btn-outline-primary" %>
      <% if user_signed_in? %>
        <% if @game.reviewed_by?(current_user) %>
          <%= link_to "üìù –ú–æ—è —Ä–µ—Ü–µ–Ω–∑–∏—è", edit_review_path(@game.user_review(current_user)), class: "btn btn-outline-warning" %>
        <% else %>
          <%= link_to "üìù –ù–∞–ø–∏—Å–∞—Ç—å —Ä–µ—Ü–µ–Ω–∑–∏—é", new_game_review_path(@game), class: "btn btn-outline-success" %>
        <% end %>
      <% end %>
      <%= link_to "üóëÔ∏è –£–¥–∞–ª–∏—Ç—å", @game, 
          method: :delete, 
          class: "btn btn-outline-danger",
          data: { confirm: "–£–¥–∞–ª–∏—Ç—å –∏–≥—Ä—É '#{@game.title}'?" } %>
    </div>
  </div>
  
  <div class="row mt-4">
    <% if @game.cover_url.present? %>
      <div class="col-md-4">
        <img src="<%= @game.cover_url %>" 
             alt="<%= @game.title %>" 
             class="img-fluid rounded shadow"
             style="max-height: 400px; object-fit: cover;">
      </div>
    <% end %>
    
    <div class="<%= @game.cover_url.present? ? 'col-md-8' : 'col-12' %>">
      <div class="card">
        <div class="card-body">
          <div class="row mb-3">
            <div class="col-md-6">
              <p><strong>üìÖ –î–∞—Ç–∞ –≤—ã—Ö–æ–¥–∞:</strong> <%= @game.release_date %></p>
            </div>
            <% if @game.metacritic_score.present? %>
              <div class="col-md-6">
                <p>
                  <strong>‚≠ê Metacritic:</strong> 
                  <span class="badge bg-<%= @game.metacritic_score >= 75 ? 'success' : @game.metacritic_score >= 50 ? 'warning' : 'danger' %>">
                    <%= @game.metacritic_score %>/100
                  </span>
                </p>
              </div>
            <% end %>
          </div>
          
          <% if @game.developers.any? %>
            <p><strong>üë®‚Äçüíª –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏:</strong> <%= @game.developer_names %></p>
          <% end %>
          
          <h5 class="mt-4">üìñ –û–ø–∏—Å–∞–Ω–∏–µ</h5>
          <div class="description-box p-3 bg-light rounded">
            <%= simple_format(@game.description) %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row mt-5">
    <div class="col-12">
      <h3 class="mb-4">üìù –†–µ—Ü–µ–Ω–∑–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
      
      <% if user_signed_in? %>
        <div class="mb-4">
          <% if @game.reviewed_by?(current_user) %>
            <%= link_to "‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ—é —Ä–µ—Ü–µ–Ω–∑–∏—é", edit_review_path(@game.user_review(current_user)), 
                class: "btn btn-warning" %>
          <% else %>
            <%= link_to "‚ûï –ù–∞–ø–∏—Å–∞—Ç—å —Ä–µ—Ü–µ–Ω–∑–∏—é", new_game_review_path(@game), 
                class: "btn btn-primary" %>
          <% end %>
          <%= link_to "üëÅÔ∏è –í—Å–µ —Ä–µ—Ü–µ–Ω–∑–∏–∏ (#{@game.reviews.count})", game_reviews_path(@game), 
              class: "btn btn-outline-secondary" %>
        </div>
      <% end %>
      
      <% if @game.reviews.any? %>
        <% @game.reviews.order(created_at: :desc).limit(3).each do |review| %>
          <div class="card mb-3">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start">
                <div>
                  <h5><%= review.title %></h5>
                  <p class="text-muted small mb-2">
                    <%= review.user.email %> ‚Ä¢ <%= review.created_at.strftime("%d.%m.%Y") %>
                  </p>
                </div>
                <div class="text-end">
                  <span class="badge bg-warning fs-6"><%= review.rating %>/10</span>
                  <div class="mt-2">
                    <span class="text-muted small">
                      <i class="bi bi-heart"></i> <%= review.likes.count %>
                      <i class="bi bi-chat ms-2"></i> <%= review.comments.count %>
                    </span>
                  </div>
                </div>
              </div>
              <p><%= truncate(review.content, length: 300) %></p>
              <%= link_to "–ß–∏—Ç–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é ‚Üí", review_path(review), 
                  class: "btn btn-sm btn-outline-primary" %>
            </div>
          </div>
        <% end %>
        
        <% if @game.reviews.count > 3 %>
          <div class="text-center mt-3">
            <%= link_to "–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ä–µ—Ü–µ–Ω–∑–∏–∏ (#{@game.reviews.count})", game_reviews_path(@game), 
                class: "btn btn-outline-secondary" %>
          </div>
        <% end %>
      <% else %>
        <div class="alert alert-info">
          <p>–ü–æ–∫–∞ –Ω–µ—Ç —Ä–µ—Ü–µ–Ω–∑–∏–π –Ω–∞ —ç—Ç—É –∏–≥—Ä—É. <% if user_signed_in? %>–ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!<% else %>–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –Ω–∞–ø–∏—Å–∞—Ç—å –ø–µ—Ä–≤—É—é.<% end %></p>
        </div>
      <% end %>
    </div>
  </div>
</div>