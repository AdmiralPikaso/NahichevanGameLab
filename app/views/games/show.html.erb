<div class="game-show">
  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
  <div class="d-flex justify-content-between align-items-start mb-4">
    <div>
      <h1 class="mb-1">
        <%= @game.title %>
        <% if user_signed_in? && current_user.in_wishlist?(@game) %>
          <span class="badge bg-danger ms-2">
            <i class="bi bi-heart-fill"></i> –í –≤–∏—à–ª–∏—Å—Ç–µ
          </span>
        <% end %>
      </h1>
      <% if @game.metacritic_score.present? %>
        <div class="d-flex align-items-center mt-2">
          <strong class="me-2">–†–µ–π—Ç–∏–Ω–≥:</strong>
          <div class="metacritic-badge">
            <span class="badge bg-<%= @game.metacritic_score >= 75 ? 'success' : @game.metacritic_score >= 50 ? 'warning' : 'danger' %> fs-6">
              <%= @game.metacritic_score %>/100
            </span>
            <small class="text-muted ms-2">Metacritic</small>
          </div>
        </div>
      <% end %>
    </div>
    
    <div class="btn-group" role="group">
      <%= link_to "‚Üê –í—Å–µ –∏–≥—Ä—ã", games_path, class: "btn btn-outline-secondary" %>
      <%= link_to "‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å", edit_game_path(@game), class: "btn btn-outline-primary" %>
      <%= link_to "üóëÔ∏è –£–¥–∞–ª–∏—Ç—å", @game, 
          method: :delete, 
          class: "btn btn-outline-danger",
          data: { confirm: "–£–¥–∞–ª–∏—Ç—å –∏–≥—Ä—É '#{@game.title}'?" } %>
    </div>
  </div>
  
  <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
  <div class="row">
    <!-- –û–±–ª–æ–∂–∫–∞ –∏–≥—Ä—ã -->
    <% if @game.cover_url.present? %>
      <div class="col-lg-4 col-md-5 mb-4">
        <div class="position-relative">
          <img src="<%= @game.cover_url %>" 
               alt="<%= @game.title %>" 
               class="img-fluid rounded shadow"
               style="max-height: 400px; width: 100%; object-fit: cover;">
          
          <!-- –ë–µ–π–¥–∂ –≤–∏—à–ª–∏—Å—Ç–∞ –Ω–∞ –æ–±–ª–æ–∂–∫–µ -->
          <% if user_signed_in? && current_user.in_wishlist?(@game) %>
            <div class="position-absolute top-0 end-0 m-2">
              <span class="badge bg-danger p-2">
                <i class="bi bi-heart-fill fs-5"></i>
              </span>
            </div>
          <% end %>
        </div>
        
        <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–¥ –æ–±–ª–æ–∂–∫–æ–π -->
        <div class="mt-3">
          <% if user_signed_in? %>
            <div class="d-grid gap-2">
              <!-- –ö–Ω–æ–ø–∫–∞ –≤–∏—à–ª–∏—Å—Ç–∞ -->
              <% if current_user.in_wishlist?(@game) %>
                <%= link_to wishlist_path(current_user.wishlists.find_by(game: @game)), 
                      method: :delete,
                      class: "btn btn-danger",
                      data: { confirm: "–£–¥–∞–ª–∏—Ç—å '#{@game.title}' –∏–∑ –≤–∏—à–ª–∏—Å—Ç–∞?" } do %>
                  <i class="bi bi-heartbreak-fill"></i> –£–¥–∞–ª–∏—Ç—å –∏–∑ –≤–∏—à–ª–∏—Å—Ç–∞
                <% end %>
              <% else %>
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addToWishlistModal">
                  <i class="bi bi-heart"></i> –î–æ–±–∞–≤–∏—Ç—å –≤ –≤–∏—à–ª–∏—Å—Ç
                </button>
              <% end %>
              
              <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é -->
              <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addToCollectionModal">
                <i class="bi bi-folder-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é
              </button>
            </div>
          <% else %>
            <div class="alert alert-info text-center">
              <i class="bi bi-info-circle"></i>
              <%= link_to "–í–æ–π–¥–∏—Ç–µ", new_user_session_path, class: "alert-link" %> 
              —á—Ç–æ–±—ã –¥–æ–±–∞–≤–ª—è—Ç—å –∏–≥—Ä—ã –≤ –≤–∏—à–ª–∏—Å—Ç –∏ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
    
    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏–≥—Ä–µ -->
    <div class="<%= @game.cover_url.present? ? 'col-lg-8 col-md-7' : 'col-12' %>">
      <div class="card h-100">
        <div class="card-body">
          <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ -->
          <div class="row mb-4">
            <div class="col-md-6">
              <div class="detail-item mb-3">
                <h6 class="text-muted mb-1">
                  <i class="bi bi-calendar"></i> –î–∞—Ç–∞ –≤—ã—Ö–æ–¥–∞
                </h6>
                <p class="fs-5">
                  <% if @game.release_date %>
                    <%= l(@game.release_date, format: :long) %>
                    <% if @game.release_date > Date.today %>
                      <span class="badge bg-warning text-dark ms-2">
                        <i class="bi bi-clock"></i> –°–∫–æ—Ä–æ
                      </span>
                    <% end %>
                  <% else %>
                    <span class="text-muted">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</span>
                  <% end %>
                </p>
              </div>
            </div>
            
            <div class="col-md-6">
              <div class="detail-item mb-3">
                <h6 class="text-muted mb-1">
                  <i class="bi bi-people"></i> –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏
                </h6>
                <div>
                  <% if @game.developers.any? %>
                    <% @game.developers.each do |developer| %>
                      <%= link_to developer.name, developer_path(developer), class: "badge bg-info text-decoration-none me-1 mb-1" %>
                    <% end %>
                  <% else %>
                    <span class="text-muted">–ù–µ —É–∫–∞–∑–∞–Ω—ã</span>
                  <% end %>
                </div>
              </div>
            </div>
          </div>
          
          <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–∏—à–ª–∏—Å—Ç–∞ -->
          <% if @game.wishlists.any? %>
            <div class="alert alert-light border mb-4">
              <div class="row align-items-center">
                <div class="col-md-8">
                  <h6 class="mb-0">
                    <i class="bi bi-heart text-danger"></i>
                    –í –≤–∏—à–ª–∏—Å—Ç–µ —É <%= @game.wishlists.count %> –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                  </h6>
                </div>
                <div class="col-md-4 text-end">
                  <% if user_signed_in? %>
                    <% if current_user.in_wishlist?(@game) %>
                      <span class="badge bg-danger">–£ –≤–∞—Å –≤ –≤–∏—à–ª–∏—Å—Ç–µ</span>
                    <% else %>
                      <span class="badge bg-secondary">–ù–µ –≤ –≤–∞—à–µ–º –≤–∏—à–ª–∏—Å—Ç–µ</span>
                    <% end %>
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
          
          <!-- –û–ø–∏—Å–∞–Ω–∏–µ –∏–≥—Ä—ã -->
          <div class="description-section">
            <h5 class="mb-3">
              <i class="bi bi-journal-text"></i> –û–ø–∏—Å–∞–Ω–∏–µ
            </h5>
            <div class="description-box p-4 bg-light rounded">
              <% if @game.description.present? %>
                <%= simple_format(@game.description) %>
              <% else %>
                <p class="text-muted text-center py-3">
                  <i class="bi bi-info-circle"></i> –û–ø–∏—Å–∞–Ω–∏–µ –∏–≥—Ä—ã –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ
                </p>
              <% end %>
            </div>
          </div>
          
          <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
          <div class="row mt-4">
            <div class="col-md-6">
              <div class="card">
                <div class="card-header">
                  <h6 class="mb-0">
                    <i class="bi bi-collection"></i> –í –∫–æ–ª–ª–µ–∫—Ü–∏—è—Ö
                  </h6>
                </div>
                <div class="card-body text-center">
                  <h3 class="text-primary"><%= @game.collections.count %></h3>
                  <p class="text-muted mb-0">—Ä–∞–∑</p>
                </div>
              </div>
            </div>
            
            <div class="col-md-6">
              <div class="card">
                <div class="card-header">
                  <h6 class="mb-0">
                    <i class="bi bi-heart"></i> –í –≤–∏—à–ª–∏—Å—Ç–∞—Ö
                  </h6>
                </div>
                <div class="card-body text-center">
                  <h3 class="text-danger"><%= @game.wishlists.count %></h3>
                  <p class="text-muted mb-0">–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –≤–∏—à–ª–∏—Å—Ç -->
  <div class="modal fade" id="addToWishlistModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">–î–æ–±–∞–≤–∏—Ç—å –≤ –≤–∏—à–ª–∏—Å—Ç</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <%= form_with(url: wishlists_path, method: :post, local: true) do |form| %>
          <%= hidden_field_tag :game_id, @game.id %>
          <div class="modal-body">
            <div class="mb-3">
              <label class="form-label fw-bold"><%= @game.title %></label>
              <p class="text-muted">–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –≤–∏—à–ª–∏—Å—Ç</p>
            </div>
            
            <div class="mb-3">
              <label class="form-label">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:</label>
              <select name="priority" class="form-select" required>
                <option value="must_have">üî• –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ - –æ—á–µ–Ω—å —Ö–æ—á—É —ç—Ç—É –∏–≥—Ä—É</option>
                <option value="high" selected>üîº –í—ã—Å–æ–∫–∏–π - –ø–ª–∞–Ω–∏—Ä—É—é –∫—É–ø–∏—Ç—å –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è</option>
                <option value="medium">‚ÜîÔ∏è –°—Ä–µ–¥–Ω–∏–π - –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ, –Ω–æ –Ω–µ —Å—Ä–æ—á–Ω–æ</option>
                <option value="low">üîΩ –ù–∏–∑–∫–∏–π - –Ω–∞ –±—É–¥—É—â–µ–µ</option>
              </select>
              <div class="form-text">
                –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–≥—Ä—ã –≤ –≤–∏—à–ª–∏—Å—Ç–µ
              </div>
            </div>
            
            <div class="mb-3">
              <label class="form-label">–ó–∞–º–µ—Ç–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
              <%= text_area_tag :notes, "", 
                    class: "form-control", 
                    rows: 3,
                    placeholder: "–ü–æ—á–µ–º—É –≤—ã —Ö–æ—Ç–∏—Ç–µ —ç—Ç—É –∏–≥—Ä—É? –ß—Ç–æ –≤–∞—Å –ø—Ä–∏–≤–ª–µ–∫–ª–æ?" %>
              <div class="form-text">
                –ù–∞–ø—Ä–∏–º–µ—Ä: "–•–æ—á—É –∏–∑-–∑–∞ —Å—é–∂–µ—Ç–∞", "–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–ª –¥—Ä—É–≥", "–ñ–¥—É —Å–∫–∏–¥–∫—É"
              </div>
            </div>
            
            <div class="alert alert-info">
              <i class="bi bi-info-circle"></i>
              –ò–≥—Ä–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –≤–∞—à <strong>–ª–∏—á–Ω—ã–π –≤–∏—à–ª–∏—Å—Ç</strong>. 
              –í—ã —Å–º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å –∏–≥—Ä—É –ø–æ–∑–∂–µ.
            </div>
          </div>
          
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
            <button type="submit" class="btn btn-primary">
              <i class="bi bi-heart-fill"></i> –î–æ–±–∞–≤–∏—Ç—å –≤ –≤–∏—à–ª–∏—Å—Ç
            </button>
          </div>
        <% end %>
      </div>
    </div>
  </div>
  
  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é -->
  <div class="modal fade" id="addToCollectionModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        
        <div class="modal-body">
          <% if user_signed_in? && current_user.collections.any? %>
            <%= form_with(url: "#", method: :post, id: "addToCollectionForm") do |form| %>
              <%= hidden_field_tag :game_id, @game.id %>
              
              <div class="mb-3">
                <label class="form-label fw-bold">–ò–≥—Ä–∞: <%= @game.title %></label>
              </div>
              
              <div class="mb-3">
                <label class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª–ª–µ–∫—Ü–∏—é:</label>
                <select name="collection_id" class="form-select" required>
                  <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª–ª–µ–∫—Ü–∏—é...</option>
                  <% current_user.collections.each do |collection| %>
                    <option value="<%= collection.id %>">
                      <%= collection.name %> 
                      (<%= collection.games.count %> –∏–≥—Ä)
                    </option>
                  <% end %>
                </select>
                <div class="form-text">
                  –ò–ª–∏ <%= link_to "—Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –∫–æ–ª–ª–µ–∫—Ü–∏—é", new_collection_path %>
                </div>
              </div>
              
              <div class="mb-3">
                <label class="form-label">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
                <%= text_area_tag :notes, "", 
                      class: "form-control", 
                      rows: 2,
                      placeholder: "–ü–æ—á–µ–º—É –¥–æ–±–∞–≤–∏–ª–∏ —ç—Ç—É –∏–≥—Ä—É –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é?" %>
              </div>
            <% end %>
          <% else %>
            <div class="text-center py-4">
              <i class="bi bi-folder-x display-1 text-muted"></i>
              <h5 class="mt-3">–£ –≤–∞—Å –µ—â–µ –Ω–µ—Ç –∫–æ–ª–ª–µ–∫—Ü–∏–π</h5>
              <p class="text-muted">–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ—é –ø–µ—Ä–≤—É—é –∫–æ–ª–ª–µ–∫—Ü–∏—é –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∏–≥—Ä</p>
              <%= link_to "–°–æ–∑–¥–∞—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏—é", new_collection_path, class: "btn btn-primary" %>
            </div>
          <% end %>
        </div>
        
        <% if user_signed_in? && current_user.collections.any? %>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
            <button type="button" class="btn btn-success" id="submitAddToCollection">
              <i class="bi bi-folder-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é
            </button>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>

<style>
.game-show .detail-item {
  padding: 10px;
  border-radius: 8px;
  background: #f8f9fa;
}

.game-show .description-box {
  line-height: 1.8;
  font-size: 1.05rem;
}

.game-show .metacritic-badge {
  display: inline-flex;
  align-items: center;
}

.game-show .btn-group .btn {
  border-radius: 6px;
  margin-left: 5px;
}

.game-show img {
  transition: transform 0.3s;
}

.game-show img:hover {
  transform: scale(1.02);
}

.description-section {
  margin-top: 30px;
  padding-top: 20px;
  border-top: 1px solid #e0e0e0;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é
  const addToCollectionModal = document.getElementById('addToCollectionModal');
  if (addToCollectionModal) {
    // –û–±–Ω–æ–≤–ª—è–µ–º action —Ñ–æ—Ä–º—ã –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤—ã–±–æ—Ä–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
    const collectionSelect = document.querySelector('#addToCollectionModal select[name="collection_id"]');
    if (collectionSelect) {
      collectionSelect.addEventListener('change', function() {
        const form = document.getElementById('addToCollectionForm');
        const gameId = <%= @game.id %>;
        form.action = `/collections/${this.value}/add_game/${gameId}`;
      });
      
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º action —Ñ–æ—Ä–º—ã –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
      addToCollectionModal.addEventListener('show.bs.modal', function() {
        const form = document.getElementById('addToCollectionForm');
        const gameId = <%= @game.id %>;
        const selectedCollectionId = collectionSelect.value;
        if (selectedCollectionId) {
          form.action = `/collections/${selectedCollectionId}/add_game/${gameId}`;
        }
      });
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
    const submitBtn = document.getElementById('submitAddToCollection');
    if (submitBtn) {
      submitBtn.addEventListener('click', function() {
        const form = document.getElementById('addToCollectionForm');
        const collectionId = document.querySelector('select[name="collection_id"]').value;
        
        if (!collectionId) {
          alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª–ª–µ–∫—Ü–∏—é');
          return;
        }
        
        form.submit();
      });
    }
  }
  
  // –ê–Ω–∏–º–∞—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –≤–∏—à–ª–∏—Å—Ç
  const wishlistButtons = document.querySelectorAll('[data-bs-target="#addToWishlistModal"]');
  wishlistButtons.forEach(btn => {
    btn.addEventListener('click', function() {
      // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é –∏–ª–∏ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫—É
    });
  });
});
</script>