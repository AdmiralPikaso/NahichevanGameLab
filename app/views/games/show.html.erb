<div class="game-show">
  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
  <div class="d-flex justify-content-between align-items-start mb-4">
    <div>
      <%= link_to "‚Üê –í—Å–µ –∏–≥—Ä—ã", games_path, class: "btn btn-outline-secondary" %>
      <%= link_to "‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å", edit_game_path(@game), class: "btn btn-outline-primary" %>
      <% if user_signed_in? %>
        <% if @game.reviewed_by?(current_user) %>
          <%= link_to "üìù –ú–æ—è —Ä–µ—Ü–µ–Ω–∑–∏—è", edit_review_path(@game.user_review(current_user)), class: "btn btn-outline-warning" %>
        <% else %>
          <%= link_to "üìù –ù–∞–ø–∏—Å–∞—Ç—å —Ä–µ—Ü–µ–Ω–∑–∏—é", new_game_review_path(@game), class: "btn btn-outline-success" %>
        <% end %>
      <% end %>
      <%= link_to "üóëÔ∏è –£–¥–∞–ª–∏—Ç—å", @game, 
          method: :delete, 
          class: "btn btn-outline-danger",
          data: { confirm: "–£–¥–∞–ª–∏—Ç—å –∏–≥—Ä—É '#{@game.title}'?" } %>
      <h1 class="mb-1"><%= @game.title %></h1>
      <% if @game.metacritic_score.present? %>
        <div class="d-flex align-items-center mt-2">
          <strong class="me-2">–†–µ–π—Ç–∏–Ω–≥:</strong>
          <div class="metacritic-badge">
            <span class="badge bg-<%= @game.metacritic_score >= 75 ? 'success' : @game.metacritic_score >= 50 ? 'warning' : 'danger' %> fs-6">
              <%= @game.metacritic_score %>/100
            </span>
            <small class="text-muted ms-2">Metacritic</small>
          </div>
        </div>
      <% end %>
    </div>
    
    <div class="btn-group" role="group">
      <%= link_to "‚Üê –í—Å–µ –∏–≥—Ä—ã", games_path, class: "btn btn-outline-secondary" %>
      <%= link_to "‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å", edit_game_path(@game), class: "btn btn-outline-primary" %>
      <!-- –£–ü–†–û–©–ï–ù–ù–ê–Ø –ö–ù–û–ü–ö–ê –†–ï–¶–ï–ù–ó–ò–ò -->
      <% if user_signed_in? %>
        <%# –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ - –µ—Å—Ç—å –ª–∏ —É–∂–µ —Ä–µ—Ü–µ–Ω–∑–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è %>
        <% user_review = @game.reviews.find_by(user_id: current_user.id) %>
        
        <% if user_review %>
          <%= link_to "üìù –ú–æ—è —Ä–µ—Ü–µ–Ω–∑–∏—è", edit_review_path(user_review), class: "btn btn-outline-warning" %>
        <% else %>
          <%= link_to "üìù –ù–∞–ø–∏—Å–∞—Ç—å —Ä–µ—Ü–µ–Ω–∑–∏—é", new_game_review_path(@game), class: "btn btn-outline-success" %>
        <% end %>
      <% end %>
      <%= form_with(model: @game, method: :delete, local: true, 
    html: { class: "d-inline" }) do |form| %>
  <%= form.submit "üóëÔ∏è –£–¥–∞–ª–∏—Ç—å", 
        class: "btn btn-outline-danger",
        data: { confirm: "–£–¥–∞–ª–∏—Ç—å –∏–≥—Ä—É '#{@game.title}'?" } %>
<% end %>
    </div>
  </div>
  
  <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
  <div class="row">
    <!-- –û–±–ª–æ–∂–∫–∞ –∏–≥—Ä—ã -->
    <% if @game.cover_url.present? %>
      <div class="col-md-4">
        <img src="<%= @game.cover_url %>" 
             alt="<%= @game.title %>" 
             class="img-fluid rounded shadow"
             style="max-height: 400px; object-fit: cover;">
        
        <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–¥ –æ–±–ª–æ–∂–∫–æ–π -->
        <div class="mt-3">
          <% if user_signed_in? %>
            <div class="alert alert-info text-center">
              <i class="bi bi-info-circle"></i>
              –§—É–Ω–∫—Ü–∏–∏ –≤–∏—à–ª–∏—Å—Ç–∞ –∏ –∫–æ–ª–ª–µ–∫—Ü–∏–π –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ–∑–∂–µ
            </div>
          <% else %>
            <div class="alert alert-info text-center">
              <i class="bi bi-info-circle"></i>
              <%= link_to "–í–æ–π–¥–∏—Ç–µ", new_user_session_path, class: "alert-link" %> 
              –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
            </div>
          <% end %>
        </div>

      </div>
    <% end %>
    
    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏–≥—Ä–µ -->
    <div class="<%= @game.cover_url.present? ? 'col-lg-8 col-md-7' : 'col-12' %>">
      <div class="card h-100">
        <div class="card-body">
          <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ -->
          <div class="row mb-4">
            <div class="col-md-6">
              <p><strong>üìÖ –î–∞—Ç–∞ –≤—ã—Ö–æ–¥–∞:</strong> <%= @game.release_date %></p>
            </div>
            <% if @game.metacritic_score.present? %>
              <div class="col-md-6">
                <p>
                  <strong>‚≠ê Metacritic:</strong> 
                  <span class="badge bg-<%= @game.metacritic_score >= 75 ? 'success' : @game.metacritic_score >= 50 ? 'warning' : 'danger' %>">
                    <%= @game.metacritic_score %>/100
                  </span>
                </p>
              </div>
            </div>
            
            <div class="col-md-6">
              <div class="detail-item mb-3">
                <h6 class="text-muted mb-1">
                  <i class="bi bi-people"></i> –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏
                </h6>
                <div>
                  <% if @game.developers.any? %>
                    <% @game.developers.each do |developer| %>
                      <%= link_to developer.name, developer_path(developer), class: "badge bg-info text-decoration-none me-1 mb-1" %>
                    <% end %>
                  <% else %>
                    <span class="text-muted">–ù–µ —É–∫–∞–∑–∞–Ω—ã</span>
                  <% end %>
                </div>
              </div>
            </div>
          </div>
          
          <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–∏—à–ª–∏—Å—Ç–∞ -->
          <% if @game.wishlists.any? %>
            <div class="alert alert-light border mb-4">
              <div class="row align-items-center">
                <div class="col-md-8">
                  <h6 class="mb-0">
                    <i class="bi bi-heart text-danger"></i>
                    –í –≤–∏—à–ª–∏—Å—Ç–µ —É <%= @game.wishlists.count %> –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                  </h6>
                </div>
                <div class="col-md-4 text-end">
                  <% if user_signed_in? %>
                    <% if current_user.in_wishlist?(@game) %>
                      <span class="badge bg-danger">–£ –≤–∞—Å –≤ –≤–∏—à–ª–∏—Å—Ç–µ</span>
                    <% else %>
                      <span class="badge bg-secondary">–ù–µ –≤ –≤–∞—à–µ–º –≤–∏—à–ª–∏—Å—Ç–µ</span>
                    <% end %>
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
          
          <!-- –û–ø–∏—Å–∞–Ω–∏–µ –∏–≥—Ä—ã -->
          <div class="description-section">
            <h5 class="mb-3">
              <i class="bi bi-journal-text"></i> –û–ø–∏—Å–∞–Ω–∏–µ
            </h5>
            <div class="description-box p-4 bg-light rounded">
              <% if @game.description.present? %>
                <%= simple_format(@game.description) %>
              <% else %>
                <p class="text-muted text-center py-3">
                  <i class="bi bi-info-circle"></i> –û–ø–∏—Å–∞–Ω–∏–µ –∏–≥—Ä—ã –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ
                </p>
              <% end %>
            </div>
          </div>
          
          <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
          <div class="row mt-4">
            <div class="col-md-6">
              <div class="card">
                <div class="card-header">
                  <h6 class="mb-0">
                    <i class="bi bi-collection"></i> –í –∫–æ–ª–ª–µ–∫—Ü–∏—è—Ö
                  </h6>
                </div>
                <div class="card-body text-center">
                  <h3 class="text-primary"><%= @game.collections.count %></h3>
                  <p class="text-muted mb-0">—Ä–∞–∑</p>
                </div>
              </div>
            </div>
            
            <div class="col-md-6">
              <div class="card">
                <div class="card-header">
                  <h6 class="mb-0">
                    <i class="bi bi-heart"></i> –í –≤–∏—à–ª–∏—Å—Ç–∞—Ö
                  </h6>
                </div>
                <div class="card-body text-center">
                  <h3 class="text-danger"><%= @game.wishlists.count %></h3>
                  <p class="text-muted mb-0">–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
      </div>
    </div>
  </div>
  
  <!-- –†–∞–∑–¥–µ–ª —Ä–µ—Ü–µ–Ω–∑–∏–π -->
  <div class="row mt-5">
    <div class="col-12">
      <h3 class="mb-4">üìù –†–µ—Ü–µ–Ω–∑–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
      
      <% if user_signed_in? %>
        <div class="mb-4">
          <!-- –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ find_by -->
          <% user_review = @game.reviews.find_by(user_id: current_user.id) %>
          
          <% if user_review %>
            <%= link_to "‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ—é —Ä–µ—Ü–µ–Ω–∑–∏—é", edit_review_path(user_review), 
                class: "btn btn-warning me-2" %>
          <% else %>
            <%= link_to "‚ûï –ù–∞–ø–∏—Å–∞—Ç—å —Ä–µ—Ü–µ–Ω–∑–∏—é", new_game_review_path(@game), 
                class: "btn btn-primary me-2" %>
          <% end %>
          
          <% if @game.reviews.any? %>
            <%= link_to "üëÅÔ∏è –í—Å–µ —Ä–µ—Ü–µ–Ω–∑–∏–∏ (#{@game.reviews.count})", game_reviews_path(@game), 
                class: "btn btn-outline-secondary" %>
          <% end %>
        </div>
      <% else %>
        <div class="alert alert-info mb-4">
          <%= link_to "–í–æ–π–¥–∏—Ç–µ", new_user_session_path, class: "alert-link" %> 
          —á—Ç–æ–±—ã –Ω–∞–ø–∏—Å–∞—Ç—å —Ä–µ—Ü–µ–Ω–∑–∏—é
        </div>
      <% end %>
      
      <% if @game.reviews.any? %>
        <% @game.reviews.order(created_at: :desc).each do |review| %>
          <div class="card mb-3">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start">
                <div>
                  <h5><%= review.title %></h5>
                  <p class="text-muted small mb-2">
                    <%= review.user.email %> ‚Ä¢ <%= review.created_at.strftime("%d.%m.%Y") %>
                  </p>
                </div>
                <div class="text-end">
                  <span class="badge bg-warning fs-6"><%= review.rating %>/10</span>
                </div>
              </div>
              <p><%= review.content %></p>
              
              <!-- –ö–Ω–æ–ø–∫–∏ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ —Ä–µ—Ü–µ–Ω–∑–∏–∏ -->
              <% if review.user == current_user %>
                <div class="mt-2">
                  <%= link_to "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å", edit_review_path(review), 
                      class: "btn btn-sm btn-outline-warning me-2" %>
                  <%= link_to "–£–¥–∞–ª–∏—Ç—å", review_path(review), 
                      method: :delete,
                      class: "btn btn-sm btn-outline-danger",
                      data: { confirm: "–£–¥–∞–ª–∏—Ç—å —Ä–µ—Ü–µ–Ω–∑–∏—é?" } %>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
      <% else %>
        <div class="alert alert-info">
          <p>–ü–æ–∫–∞ –Ω–µ—Ç —Ä–µ—Ü–µ–Ω–∑–∏–π –Ω–∞ —ç—Ç—É –∏–≥—Ä—É.</p>
        </div>
      <% end %>
    </div>
  </div>
</div>

<style>
.game-show .detail-item {
  padding: 10px;
  border-radius: 8px;
  background: #f8f9fa;
}

.game-show .description-box {
  line-height: 1.8;
  font-size: 1.05rem;
}

.game-show .metacritic-badge {
  display: inline-flex;
  align-items: center;
}

.game-show .btn-group .btn {
  border-radius: 6px;
  margin-left: 5px;
}

.game-show img {
  transition: transform 0.3s;
}

.game-show img:hover {
  transform: scale(1.02);
}

.description-section {
  margin-top: 30px;
  padding-top: 20px;
  border-top: 1px solid #e0e0e0;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é
  const addToCollectionModal = document.getElementById('addToCollectionModal');
  if (addToCollectionModal) {
    // –û–±–Ω–æ–≤–ª—è–µ–º action —Ñ–æ—Ä–º—ã –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤—ã–±–æ—Ä–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
    const collectionSelect = document.querySelector('#addToCollectionModal select[name="collection_id"]');
    if (collectionSelect) {
      collectionSelect.addEventListener('change', function() {
        const form = document.getElementById('addToCollectionForm');
        const gameId = <%= @game.id %>;
        form.action = `/collections/${this.value}/add_game/${gameId}`;
      });
      
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º action —Ñ–æ—Ä–º—ã –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
      addToCollectionModal.addEventListener('show.bs.modal', function() {
        const form = document.getElementById('addToCollectionForm');
        const gameId = <%= @game.id %>;
        const selectedCollectionId = collectionSelect.value;
        if (selectedCollectionId) {
          form.action = `/collections/${selectedCollectionId}/add_game/${gameId}`;
        }
      });
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
    const submitBtn = document.getElementById('submitAddToCollection');
    if (submitBtn) {
      submitBtn.addEventListener('click', function() {
        const form = document.getElementById('addToCollectionForm');
        const collectionId = document.querySelector('select[name="collection_id"]').value;
        
        if (!collectionId) {
          alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª–ª–µ–∫—Ü–∏—é');
          return;
        }
        
        form.submit();
      });
    }
  }
  
  // –ê–Ω–∏–º–∞—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –≤–∏—à–ª–∏—Å—Ç
  const wishlistButtons = document.querySelectorAll('[data-bs-target="#addToWishlistModal"]');
  wishlistButtons.forEach(btn => {
    btn.addEventListener('click', function() {
      // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é –∏–ª–∏ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫—É
    });
  });
});
</script>

  <div class="row mt-5">
    <div class="col-12">
      <h3 class="mb-4">üìù –†–µ—Ü–µ–Ω–∑–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
      
      <% if user_signed_in? %>
        <div class="mb-4">
          <% if @game.reviewed_by?(current_user) %>
            <%= link_to "‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ—é —Ä–µ—Ü–µ–Ω–∑–∏—é", edit_review_path(@game.user_review(current_user)), 
                class: "btn btn-warning" %>
          <% else %>
            <%= link_to "‚ûï –ù–∞–ø–∏—Å–∞—Ç—å —Ä–µ—Ü–µ–Ω–∑–∏—é", new_game_review_path(@game), 
                class: "btn btn-primary" %>
          <% end %>
          <%= link_to "üëÅÔ∏è –í—Å–µ —Ä–µ—Ü–µ–Ω–∑–∏–∏ (#{@game.reviews.count})", game_reviews_path(@game), 
              class: "btn btn-outline-secondary" %>
        </div>
      <% end %>
      
      <% if @game.reviews.any? %>
        <% @game.reviews.order(created_at: :desc).limit(3).each do |review| %>
          <div class="card mb-3">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start">
                <div>
                  <h5><%= review.title %></h5>
                  <p class="text-muted small mb-2">
                    <%= review.user.email %> ‚Ä¢ <%= review.created_at.strftime("%d.%m.%Y") %>
                  </p>
                </div>
                <div class="text-end">
                  <span class="badge bg-warning fs-6"><%= review.rating %>/10</span>
                  <div class="mt-2">
                    <span class="text-muted small">
                      <i class="bi bi-heart"></i> <%= review.likes.count %>
                      <i class="bi bi-chat ms-2"></i> <%= review.comments.count %>
                    </span>
                  </div>
                </div>
              </div>
              <p><%= truncate(review.content, length: 300) %></p>
              <%= link_to "–ß–∏—Ç–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é ‚Üí", review_path(review), 
                  class: "btn btn-sm btn-outline-primary" %>
            </div>
          </div>
        <% end %>
        
        <% if @game.reviews.count > 3 %>
          <div class="text-center mt-3">
            <%= link_to "–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ä–µ—Ü–µ–Ω–∑–∏–∏ (#{@game.reviews.count})", game_reviews_path(@game), 
                class: "btn btn-outline-secondary" %>
          </div>
        <% end %>
      <% else %>
        <div class="alert alert-info">
          <p>–ü–æ–∫–∞ –Ω–µ—Ç —Ä–µ—Ü–µ–Ω–∑–∏–π –Ω–∞ —ç—Ç—É –∏–≥—Ä—É. <% if user_signed_in? %>–ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!<% else %>–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –Ω–∞–ø–∏—Å–∞—Ç—å –ø–µ—Ä–≤—É—é.<% end %></p>
        </div>
      <% end %>
    </div>
  </div>
</div>
